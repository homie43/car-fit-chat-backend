# RAG (Retrieval-Augmented Generation) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ RAG?

**RAG** - —ç—Ç–æ —Ç–µ—Ö–Ω–∏–∫–∞, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π LLM (Large Language Model) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ–ª–∞–≥–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–≤–æ–∏ "–∑–Ω–∞–Ω–∏—è".

### –ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑ RAG:
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü–æ—Å–æ–≤–µ—Ç—É–π Toyota Camry"
LLM: "Toyota Camry - –Ω–∞–¥–µ–∂–Ω—ã–π —Å–µ–¥–∞–Ω..." [–û—Ç–≤–µ—Ç –∏–∑ –æ–±—â–∏—Ö –∑–Ω–∞–Ω–∏–π –º–æ–¥–µ–ª–∏]
```
‚ùå LLM –º–æ–∂–µ—Ç –ø—Ä–∏–¥—É–º–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚ùå –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–µ–π
‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª—è—Ö –∏–∑ –ù–ê–®–ï–ô –±–∞–∑—ã

### –° RAG:
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü–æ—Å–æ–≤–µ—Ç—É–π Toyota Camry"

1. –ü–æ–∏—Å–∫ –≤ –ë–î ‚Üí –ù–∞—Ö–æ–¥–∏—Ç Toyota Camry 2.5 AT (181 –ª.—Å.) 2018-2020
2. –î–æ–±–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ–º–ø—Ç LLM
3. LLM: "–í –Ω–∞—à–µ–π –±–∞–∑–µ –µ—Å—Ç—å Toyota Camry 2.5 AT (181 –ª.—Å.) 2018-2020 –≥–æ–¥–æ–≤.
        –ù–∞–¥–µ–∂–Ω—ã–π —Å–µ–¥–∞–Ω –±–∏–∑–Ω–µ—Å-–∫–ª–∞—Å—Å–∞ —Å —ç–∫–æ–Ω–æ–º–∏—á–Ω—ã–º –¥–≤–∏–≥–∞—Ç–µ–ª–µ–º..." [–û—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –†–ï–ê–õ–¨–ù–´–• –¥–∞–Ω–Ω—ã—Ö]
```
‚úÖ –û—Ç–≤–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î
‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
‚úÖ –¢–æ–ª—å–∫–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –∏–∑ –ù–ê–®–ï–ì–û –∫–∞—Ç–∞–ª–æ–≥–∞

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RAG –≤ CarFit Chat

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨                                             ‚îÇ
‚îÇ    "–ù—É–∂–µ–Ω –Ω–∞–¥–µ–∂–Ω—ã–π —Å–µ–¥–∞–Ω Toyota"                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. –ò–ó–í–õ–ï–ß–ï–ù–ò–ï –ü–†–ï–î–ü–û–ß–¢–ï–ù–ò–ô                                  ‚îÇ
‚îÇ    - –ò–∑ User.preferences (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ)                      ‚îÇ
‚îÇ    - –ò–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è                                  ‚îÇ
‚îÇ    –†–µ–∑—É–ª—å—Ç–∞—Ç: { marka: "Toyota", bodyType: "sedan" }        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. –ü–û–ò–°–ö –ü–û –ë–î (cars.service.searchCarsForRAG)             ‚îÇ
‚îÇ    WHERE brand LIKE '%Toyota%'                              ‚îÇ
‚îÇ      AND bodyType LIKE '%sedan%'                            ‚îÇ
‚îÇ      AND description IS NOT NULL                            ‚îÇ
‚îÇ    LIMIT 5                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–ò–°–ö–ê                                        ‚îÇ
‚îÇ    [                                                        ‚îÇ
‚îÇ      {                                                      ‚îÇ
‚îÇ        brand: "Toyota",                                     ‚îÇ
‚îÇ        model: "Camry",                                      ‚îÇ
‚îÇ        variant: "2.5 AT (181 –ª.—Å.)",                        ‚îÇ
‚îÇ        description: "–ù–∞–¥–µ–∂–Ω—ã–π —Å–µ–¥–∞–Ω...",                    ‚îÇ
‚îÇ        yearFrom: 2018,                                      ‚îÇ
‚îÇ        yearTo: 2020                                         ‚îÇ
‚îÇ      }                                                      ‚îÇ
‚îÇ    ]                                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 5. –§–û–†–ú–ò–†–û–í–ê–ù–ò–ï –ö–û–ù–¢–ï–ö–°–¢–ê                                   ‚îÇ
‚îÇ    "–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–ò–°–ö–ê –ü–û –ë–ê–ó–ï –î–ê–ù–ù–´–•:                       ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ     –ù–∞–π–¥–µ–Ω–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π: 1                                  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ     1. Toyota Camry                                         ‚îÇ
‚îÇ        –í–∞—Ä–∏–∞–Ω—Ç: 2.5 AT (181 –ª.—Å.)                           ‚îÇ
‚îÇ        –ì–æ–¥—ã –≤—ã–ø—É—Å–∫–∞: 2018-2020                              ‚îÇ
‚îÇ        –û–ø–∏—Å–∞–Ω–∏–µ: –ù–∞–¥–µ–∂–Ω—ã–π —Å–µ–¥–∞–Ω –±–∏–∑–Ω–µ—Å-–∫–ª–∞—Å—Å–∞...            ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ     –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —ç—Ç–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏"                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 6. –ü–†–û–ú–ü–¢ –î–õ–Ø LLM                                           ‚îÇ
‚îÇ    [                                                        ‚îÇ
‚îÇ      { role: "system", content: "–¢—ã ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç..." },      ‚îÇ
‚îÇ      { role: "system", content: "–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–ò–°–ö–ê..." },   ‚îÇ
‚îÇ      { role: "user", content: "–ù—É–∂–µ–Ω –Ω–∞–¥–µ–∂–Ω—ã–π —Å–µ–¥–∞–Ω..." }   ‚îÇ
‚îÇ    ]                                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 7. –û–¢–í–ï–¢ LLM                                                ‚îÇ
‚îÇ    "–í –Ω–∞—à–µ–π –±–∞–∑–µ –µ—Å—Ç—å Toyota Camry 2.5 AT (181 –ª.—Å.)        ‚îÇ
‚îÇ     2018-2020 –≥–æ–¥–æ–≤. –≠—Ç–æ –Ω–∞–¥–µ–∂–Ω—ã–π —Å–µ–¥–∞–Ω –±–∏–∑–Ω–µ—Å-–∫–ª–∞—Å—Å–∞       ‚îÇ
‚îÇ     —Å —ç–∫–æ–Ω–æ–º–∏—á–Ω—ã–º –¥–≤–∏–≥–∞—Ç–µ–ª–µ–º..."                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìÇ –§–∞–π–ª—ã –∏ –∏—Ö —Ä–æ–ª—å –≤ RAG

### 1. `ai.service.ts` - –ì–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
```typescript
async *processMessageStream(request: ProcessMessageRequest) {
  // 1. –ò–∑–≤–ª–µ—á—å preferences
  const currentPreferences = await this.extractCurrentPreferences(...);

  // 2. –ü–æ–∏—Å–∫ –ø–æ –ë–î (–µ—Å–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö)
  if (this.hasEnoughPreferencesForSearch(currentPreferences)) {
    searchResults = await carsService.searchCarsForRAG({
      marka: currentPreferences.marka,
      model: currentPreferences.model,
      limit: 5,
    });

    // 3. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è LLM
    ragContext = this.formatSearchResultsForContext(searchResults);
  }

  // 4. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ –ø—Ä–æ–º–ø—Ç
  messages.push({ role: 'system', content: ragContext });

  // 5. –í—ã–∑–≤–∞—Ç—å LLM —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
  const response = await fetch(DEEPSEEK_API, { messages });
}
```

### 2. `cars.service.ts` - –ü–æ–∏—Å–∫ –ø–æ –ë–î
```typescript
async searchCarsForRAG(params: SearchCarsParams) {
  return await prisma.carVariant.findMany({
    where: {
      description: { not: null },  // ‚ö†Ô∏è –í–ê–ñ–ù–û: —Ç–æ–ª—å–∫–æ —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏!
      // ... —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –º–∞—Ä–∫–µ, –º–æ–¥–µ–ª–∏, –≥–æ–¥—É
    },
    limit: 5,  // –¢–æ–ø-5 –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  });
}
```

### 3. `ai.prompts.ts` - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è LLM
```typescript
const SYSTEM_PROMPT = `
2. –†–ê–ë–û–¢–ê –° –†–ï–ó–£–õ–¨–¢–ê–¢–ê–ú–ò –ü–û–ò–°–ö–ê –ü–û –ë–ê–ó–ï:
   - –ï—Å–ª–∏ –µ—Å—Ç—å "–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–ò–°–ö–ê –ü–û –ë–ê–ó–ï –î–ê–ù–ù–´–•" ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –∏—Ö
   - –ó–ê–ü–†–ï–©–ï–ù–û –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –≤–Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ù–ï–¢ ‚Äî —Å–∫–∞–∂–∏ "–í –Ω–∞—à–µ–π –±–∞–∑–µ –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"
`;
```

---

## üîç –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã

### `extractCurrentPreferences()`
–ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

```typescript
private async extractCurrentPreferences(userId: string) {
  const user = await prisma.user.findUnique({
    where: { id: userId },
    select: { preferences: true },
  });

  return user?.preferences || {};
}
```

**–í –±—É–¥—É—â–µ–º**: –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LLM –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è preferences –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.

### `hasEnoughPreferencesForSearch()`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞.

```typescript
private hasEnoughPreferencesForSearch(preferences: UserPreferences): boolean {
  let filledFields = 0;
  const keyFields = ['marka', 'model', 'kpp', 'yearFrom', 'bodyType'];

  for (const field of keyFields) {
    if (preferences[field]) filledFields++;
  }

  return filledFields >= 2;  // –ú–∏–Ω–∏–º—É–º 2 –ø–æ–ª—è
}
```

### `formatSearchResultsForContext()`
–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –≤ —á–∏—Ç–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è LLM.

```typescript
private formatSearchResultsForContext(results: SearchResultForContext[]): string {
  let context = '–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–ò–°–ö–ê –ü–û –ë–ê–ó–ï –î–ê–ù–ù–´–•:\n\n';
  context += `–ù–∞–π–¥–µ–Ω–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π: ${results.length}\n\n`;

  results.forEach((car, index) => {
    context += `${index + 1}. ${car.brand} ${car.model}\n`;
    context += `   –í–∞—Ä–∏–∞–Ω—Ç: ${car.variant}\n`;
    context += `   –û–ø–∏—Å–∞–Ω–∏–µ: ${car.description}\n\n`;
  });

  context += '–í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —ç—Ç–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏.\n';
  return context;
}
```

---

## üé≠ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –£—Å–ø–µ—à–Ω—ã–π –ø–æ–∏—Å–∫
```
User: "–ù—É–∂–µ–Ω Toyota Camry"
Preferences: { marka: "Toyota", model: "Camry" }
Search DB: ‚úÖ –ù–∞–π–¥–µ–Ω–æ 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞
RAG Context: "–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–û–ò–°–ö–ê... Toyota Camry 2.5 AT..."
LLM Response: "–í –Ω–∞—à–µ–π –±–∞–∑–µ –µ—Å—Ç—å 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞ Toyota Camry..."
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
```
User: "–ü–æ—Å–æ–≤–µ—Ç—É–π Ferrari"
Preferences: { marka: "Ferrari" }
Search DB: ‚ùå –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
RAG Context: (–ø—É—Å—Ç–æ–π)
LLM Response: "–í –Ω–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ Ferrari.
               –ù–æ —è –º–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ Ferrari ‚Äî —ç—Ç–æ..."
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞
```
User: "–•–æ—á—É –∞–≤—Ç–æ–º–æ–±–∏–ª—å"
Preferences: {}  (–ø—É—Å—Ç–æ)
Search DB: ‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö)
LLM Response: "–ü–æ–º–æ–≥—É –ø–æ–¥–æ–±—Ä–∞—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—å! –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –≤–∞—à–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è—Ö:
               - –ö–∞–∫–æ–π –±—é–¥–∂–µ—Ç?
               - –¢–∏–ø –∫—É–∑–æ–≤–∞?"
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ RAG

### –¢–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:
- **–í—Å–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π**: 66,978
- **–° –æ–ø–∏—Å–∞–Ω–∏—è–º–∏**: 108
- **–ü–æ–∫—Ä—ã—Ç–∏–µ**: 0.16%

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- ‚úÖ **–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è MVP**: –ï—Å—Ç—å –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –±—Ä–µ–Ω–¥–æ–≤ (AC, Abarth)
- üìà **–†–æ—Å—Ç –≤ –±—É–¥—É—â–µ–º**: –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è —Ç–æ–ø-1000 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
- üéØ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –°–Ω–∞—á–∞–ª–∞ –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è —Å–∞–º—ã—Ö –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –º–∞—Ä–æ–∫ (Toyota, BMW, Mercedes)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ RAG

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
npx tsx src/scripts/test-rag.ts
```

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:
1. ‚úÖ –ü–æ–∏—Å–∫ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ (AC COBRA)
2. ‚úÖ –ü–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –±—Ä–µ–Ω–¥—É (Abarth)
3. ‚úÖ –ü–æ–∏—Å–∫ –±–µ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (Ferrari)
4. ‚úÖ –ü–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ (AT transmission, 2010+)
5. ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è –ë–î

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ (1-2 –Ω–µ–¥–µ–ª–∏):
1. –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è —Ç–æ–ø-500 –º–æ–¥–µ–ª–µ–π
2. –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ (1-2 –º–µ—Å—è—Ü–∞):
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (—Å–º. [ROADMAP.md](./ROADMAP.md))
2. –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π + —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π)
3. –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ (3-6 –º–µ—Å—è—Ü–µ–≤):
1. –ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ (–ø–æ —Ñ–æ—Ç–æ)
2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ü–µ–Ω–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
3. –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [ROADMAP.md](./ROADMAP.md) - –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è RAG
- [architect.md](../architect.md) - –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- [Prisma Schema](../prisma/schema.prisma) - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î
